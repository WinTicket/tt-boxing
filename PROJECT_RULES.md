# パンチ分類モデル プロジェクトルール

## 1. プロジェクト構造

### 1.1 ディレクトリ構造
```
punch_classification/
├── data/                    # データセット
│   └── winticket_boxing/
│       ├── annotations/     # アノテーションファイル
│       ├── crop_frames/    # クロップされた画像
│       ├── frames/         # 元の画像フレーム
│       ├── csv/           # 評価結果等のCSV
│       ├── original_annotations/
│       └── video/         # 元動画ファイル
├── docker/                 # Docker関連ファイル
├── model/                  # 学習済みモデル
├── output/                 # 評価結果出力
└── src/                    # ソースコード
```

### 1.2 必須ファイル
- `環境構築手順書.md`: 環境構築の手順
- `学習手順書.md`: 学習プロセスの手順
- `評価手順書.md`: 評価方法の手順

## 2. 環境要件

### 2.1 ハードウェア要件
- GPU: RTX 3090Ti以上推奨
- メモリ: 8GB以上のshared memory

### 2.2 ソフトウェア要件
- OS: Ubuntu 22.04.5 LTS
- Docker: Version 27.3.0以上
- CUDA: 11.8.0
- PyTorch: 2.5以上（torch.compile対応）

## 3. 開発プロセス

### 3.1 データ準備
1. データセットの配置
   - 指定されたディレクトリ構造に従う
   - 必要なアノテーションファイルを配置

2. データ前処理
   - フレーム抽出: `split_winticket_video.py`の使用
   - クロップ画像生成: `prepare_squaredata.py`の使用

### 3.2 学習プロセス
1. モデル設定
   - バックボーン: ResNet50
   - 入力サイズ: 224x224
   - 出力: 43クラス（Sigmoid活性化）

2. 学習パラメータ
   - オプティマイザ: Adam
   - 学習率: 1e-4
   - エポック数: 20
   - 損失関数: BinaryCrossEntropyLoss

### 3.3 評価プロセス
1. 定量評価
   - Precision-Recall曲線の生成
   - PR-AUC計算
   - 閾値別性能評価（0.05-0.95）

2. 定性評価
   - 検知結果のJSON出力
   - 可視化結果の生成

## 4. コーディング規約

### 4.1 Python コード規約
- PEP 8に準拠
- 型ヒントの使用推奨
- docstringによるドキュメント化

### 4.2 スクリプト命名規則
- 小文字とアンダースコアの使用
- 目的を明確に示す命名
- 例: `train_stack_multiframe.py`

## 5. 品質管理

### 5.1 評価指標
- PR-AUC（主要評価指標）
- クラス別Precision/Recall
- mean PR-AUC

### 5.2 閾値設定
- パンチ検出: 0.7（推奨）
- ヒット判定: 0.4（推奨）

### 5.3 モデル保存
- ベストモデルの保存: `best_prauc_model.pth`
- 評価結果の保存: `precision_recall_curve.csv`

## 6. ドキュメント管理

### 6.1 必須ドキュメント
- 環境構築手順書
- 学習手順書
- 評価手順書
- モジュールI/O仕様書

### 6.2 ドキュメント更新ルール
- 変更時の日付記録
- 作成者情報の明記
- 前提条件の明確な記載

## 7. バージョン管理

### 7.1 モデルバージョン
- 評価期間による区分（例：4Q_best）
- 性能指標の記録

### 7.2 データバージョン
- 動画ソースのバージョン管理
- アノテーションファイルの版管理

## 8. セキュリティ

### 8.1 データ保護
- 機密データの適切な管理
- アクセス権限の設定

### 8.2 環境分離
- 開発環境とテスト環境の分離
- Dockerコンテナによる環境隔離